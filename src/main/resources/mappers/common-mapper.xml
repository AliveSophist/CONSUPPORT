<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="commonMapper">

	<!-- 유저 -->
	<resultMap type="kh.study.consupport.common.vo.UsersVO" id="user">
		<id column="USER_ID" 				property="userId"/>
		<result column="USER_PW" 			property="userPw"/>
		<result column="USER_NAME" 			property="userName"/>
		<result column="USER_ADDR" 			property="userAddr"/>
		<result column="USER_ADDR_DETAIL" 	property="userAddrDetail"/>
		<result column="USER_EMAIL" 		property="userEmail"/>
		<result column="USER_BIRTH" 		property="userBirth"/>
		<result column="USER_TELL" 			property="userTell"/>
		<result column="USER_MILEAGE" 		property="userMileage"/>
		<result column="USER_ROLE" 			property="userRole"/>
		<result column="USER_STATUS" 		property="userStatus"/>
	</resultMap>
	
	<!-- 콘서트 -->
	<resultMap type="kh.study.consupport.common.vo.ConcertVO" id="concert">
		<id column="CONCERT_CODE"					property="concertCode"/>
		<result column="CONCERT_NAME" 			 	property="concertName"/>
		<result column="CONCERT_STATUS" 		 	property="concertStatus"/>
		<result column="CONCERT_RATED" 			 	property="concertRated"/>
		<result column="CONCERT_TICKETING_DATE" 	property="concertTicketingDate"/>
		<result column="CONCERT_DATE" 				property="concertDate"/>
		<result column="HALL_DATE_CODE" 			property="hallDateCode"/>
		<result column="GENRE_CODE"					property="genreCode"/>
		<result column="HALL_CODE" 					property="hallCode"/>
		<result column="USER_ID" 					property="userId"/>
		<result column="HALL_DATE_CODDE" 			property="userId"/>
		
		<association property="artist" 				resultMap="artist"/>
		<association property="concertPrice"		resultMap="concertPrice"/>
		<collection property="concertImgList" 		resultMap="concertImg"/>
	</resultMap>
	
	<!-- 콘서트 이미지 -->
	<resultMap type="kh.study.consupport.common.vo.ConcertImgVO" id="concertImg">
		<id column="CONCERT_IMG_CODE" 				property="concertImgCode"/>
		<result column="CONCERT_IMG_NAME_ORIGIN" 	property="concertImgNameOrigin"/>
		<result column="CONCERT_IMG_NAME_ATTACHED" 	property="concertImgNameAttached"/>
		<result column="CONCERT_IMG_IS_MAIN"		property="concertImgIsMain"/>
		<result column="CONCERT_CODE" 				property="concertCode"/>
	</resultMap>
	
	<!-- 아티스트 -->
	<resultMap type="kh.study.consupport.common.vo.ArtistVO" id="artist">
		<id column="USER_ID" 					property="userId"/>
		<result column="ARTIST_NAME" 			property="artistName"/>
		<result column="ARTIST_DETAIL" 			property="artistDetail"/>
		
		<association property="artistImg" 	resultMap="artistImg"/>
	</resultMap>
	<resultMap type="kh.study.consupport.common.vo.ArtistVO" id="artistDetail">
		<id column="USER_ID" 					property="userId"/>
		<result column="ARTIST_NAME" 			property="artistName"/>
		<result column="ARTIST_DETAIL" 			property="artistDetail"/>
		
		<collection property="artistImgList" 	resultMap="artistImg"/>
	</resultMap>
	
	<!--아티스트 이미지  -->
	<resultMap type="kh.study.consupport.common.vo.ArtistImgVO" id="artistImg">
		<id column="ARTIST_IMG_CODE" 				property="artistImgCode"/>
		<result column="ARTIST_IMG_NAME_ORIGIN" 	property="artistImgNameOrigin"/>
		<result column="ARTIST_IMG_NAME_ATTACHED" 	property="artistImgNameAttached"/>
		<result column="ARTIST_IMG_IS_MAIN" 		property="artistImgIsMain"/>
		<result column="USER_ID" 					property="userId"/>
	</resultMap>
	
	<!-- 콘서트 프라이스 -->
	<resultMap type="kh.study.consupport.common.vo.ConcertPriceVO" id="concertPrice">
		<id column="CONCERT_CODE" 					property="concertCode"/>
		<result column="CONCERT_PRICE_R" 			property="concertPriceR"/>
		<result column="CONCERT_PRICE_S" 			property="concertPriceS"/>
		<result column="CONCERT_PRICE_A" 			property="concertPriceA"/>
	</resultMap>
	
<!-- ============================================================================================================================================================================================================================================= -->
	
	<!-- Join -->
	<insert id="insertUser">
		INSERT INTO USERS(
		    USER_ID
		    , USER_PW
		    , USER_NAME
		    , USER_ADDR
		    , USER_ADDR_DETAIL
		    , USER_BIRTH
		    , USER_TELL
		) VALUES(
		    #{userId}
		    , #{userPw}
		    , #{userName}
		    , #{userAddr}
		    , #{userAddrDetail}
		    , #{userBirth}
		    , #{userTell}
		)
	</insert>
	
	
	<!-- Login -->
	<select id="login" resultMap="user">
		SELECT
			USER_ID
			, USER_PW
			, USER_ROLE
		FROM USERS
		WHERE
			USER_ID = #{userId}
	</select>
	
	<!-- get LoginInfo -->
	<select id="selectLoginInfo" resultMap="user">
		SELECT
			USER_ID
			, USER_NAME
			, USER_ROLE
		FROM USERS
		WHERE
			USER_ID = #{userId}
	</select>

<!-- ============================================================================================================================================================================================================================================= -->

	<!-- 메인화면 콘서트 목록 조회 -->
	<select id="selectConcertListOfCommon" resultMap="concert">
         SELECT CON.CONCERT_CODE
			, CONCERT_NAME
			, CONCERT_IMG_CODE
			, CONCERT_IMG_NAME_ATTACHED
            , CONCERT_IMG_IS_MAIN
            , CON.USER_ID
            , ART.ARTIST_NAME
            , ARTIST_IMG_NAME_ATTACHED
            , ARTIST_IMG_IS_MAIN
		FROM CONCERT CON, CONCERT_IMG CONI, ARTIST ART, ARTIST_IMG ARTI
        WHERE CON.CONCERT_CODE = CONI.CONCERT_CODE
        AND CON.USER_ID = ART.USER_ID
        AND ART.USER_ID = ARTI.USER_ID
        AND CONCERT_IMG_IS_MAIN = 'Y'
        AND ARTIST_IMG_IS_MAIN = 'Y'
        ORDER BY CONCERT_CODE DESC
	</select>

<!-- ============================================================================================================================================================================================================================================= -->
	
	<!-- 콘서트 상세 조회 -->
	<select id="selectConcertDetail" resultMap="concert">
		SELECT CON.CONCERT_CODE
			, CONCERT_NAME
			, CONCERT_RATED
			, CONCERT_TICKETING_DATE
			, (SELECT HALL_RENT_DATE
                FROM HALL_DATE
                WHERE HALL_DATE_CODE = CON.HALL_DATE_CODE) AS CONCERT_DATE
            
			, CONCERT_IMG_NAME_ATTACHED
			, CONCERT_IMG_IS_MAIN
            
			, CONCERT_PRICE_R
			, CONCERT_PRICE_S
			, CONCERT_PRICE_A
            
            , ART.USER_ID
			, ART.ARTIST_NAME
			, ARTIST_IMG_NAME_ATTACHED
			, ARTIST_IMG_IS_MAIN
            
		FROM CONCERT CON
           , CONCERT_IMG CONI
           , CONCERT_PRICE CONP
           , ARTIST ART
           , ARTIST_IMG ARTI
		WHERE CON.CONCERT_CODE = CONI.CONCERT_CODE
		AND CON.CONCERT_CODE = CONP.CONCERT_CODE
        AND CON.USER_ID = ART.USER_ID
        AND CON.USER_ID = ARTI.USER_ID
        AND ARTIST_IMG_IS_MAIN = 'Y'
        AND CON.CONCERT_CODE = #{concertCode}
        ORDER BY CONCERT_CODE ASC
	</select>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</mapper>
