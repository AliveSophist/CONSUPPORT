<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 해당 파일에 모든 쿼리문을 작성 -->
<mapper namespace="adminMapper">
	
	<!-- 아티스트 -->
	<resultMap type="kh.study.consupport.common.vo.ArtistVO" id="artist">
		<id column="USER_ID" 					property="userId"/>
		<result column="ARTIST_NAME" 			property="artistName"/>
		<result column="ARTIST_DETAIL" 			property="artistDetail"/>
		
		<association property="users" 			resultMap="users"/>
		<collection property="artistImgList" 	resultMap="artistImg"/>
	</resultMap>

	<!--아티스트 이미지  -->
	<resultMap type="kh.study.consupport.common.vo.ArtistImgVO" id="artistImg">
		<id column="ARTIST_IMG_CODE" 				property="artistImgCode"/>
		<result column="ARTIST_IMG_NAME_ORIGIN" 	property="artistImgNameOrigin"/>
		<result column="ARTIST_IMG_NAME_ATTACHED" 	property="artistImgNameAttached"/>
		<result column="ARTIST_IMG_IS_MAIN" 		property="artistImgIsMain"/>
		<result column="USER_ID" 					property="userId"/>
	</resultMap>
	
	<!-- 유저 -->
	<resultMap type="kh.study.consupport.common.vo.UsersVO" id="users">
		<id column="USER_ID" 					property="userId"/>
		<result column="USER_PW" 				property="userPw"/>
		<result column="USER_NAME" 				property="userName"/>
		<result column="USER_ADDR" 				property="userAddr"/>
		<result column="USER_ADDR_DETAIL" 		property="userAddrDetail"/>
		<result column="USER_EMAIL" 			property="userEmail"/>
		<result column="USER_BIRTH" 			property="userBirth"/>
		<result column="USER_TELL" 				property="userTell"/>
			
		<result column="USER_MILEAGE" 			property="userMileage"/>
		<result column="USER_ROLE" 				property="userRole"/>
		<result column="USER_STATUS" 			property="userStatus"/>
	</resultMap>
<!--========================================================================================================================================================================================-->

	<!-- 아티스트 목록 조회 -->
	<select id="selectArtistList" resultMap="artist">
		SELECT ART.USER_ID
		    , ARTIST_NAME
		    , ARTIST_DETAIL
		    , ARTIST_IMG_NAME_ATTACHED
		    , USER_ROLE
		FROM ARTIST ART, ARTIST_IMG ARTI, USERS US
		WHERE ART.USER_ID = ARTI.USER_ID
		AND ARTIST_IMG_IS_MAIN = 'Y'
		AND ART.USER_ID = US.USER_ID
	</select>

<!--========================================================================================================================================================================================-->

	<!-- 아티스트 승격 -->
	<update id="updateUserRoleToArtist">
		UPDATE USERS
        SET USER_ROLE = DECODE(#{userRole}
		                      , 'M', 'MEMBER'
		                      , 'A', 'ARTIST')
        WHERE USER_ID = #{userId}
	</update>

<!--========================================================================================================================================================================================-->

	<!-- 아티스트 상세 조회 -->
	<select id="selectArtistDetail" resultMap="artist">
		SELECT ART.USER_ID
            , ARTIST_NAME
            , ARTIST_DETAIL
            , ARTIST_IMG_NAME_ATTACHED
            , ARTIST_IMG_IS_MAIN
        FROM ARTIST ART, ARTIST_IMG ARTI
        WHERE ART.USER_ID = ARTI.USER_ID
        AND ART.USER_ID = #{userId}
	</select>
	
	




















































	
</mapper>
